---
title: "UPGRADE FLUTTER 3.35.6"
description: "Upgrade ke flutter 3.35.6 untuk kebutuhan support 16kb page size"
---

## INSTALL SDK 3.35.6

<Tip>
  https://docs.flutter.dev/install/archive
</Tip>

## CREATE PROJECT BARU

<Tip>
  flutter\<version\> create nama_aplikasi
</Tip>

## Cloning app custom

Contoh **pubspec.yml**

```
name: professional_flutter_3_35
description: "A new Flutter project."
version: 1.0.0+1

environment:
  sdk: ^3.9.2

dependencies:
  flutter:
    sdk: flutter

  cupertino_icons: ^1.0.8
  flutter_bloc: ^7.0.0
  flutter_dotenv: ^5.1.0
  percent_indicator: ^4.2.3
  sn_progress_dialog: ^1.0.3
  shared_preferences: ^2.2.1
  carousel_slider: ^5.1.1
  geolocator: ^11.1.0
  image_picker: any
  shimmer: ^3.0.0
  photo_view: ^0.15.0
  month_picker_dialog: ^6.7.0
  permission_handler: ^11.0.1
  app_settings: ^6.1.1
  flutter_html: any
  location: ^5.0.3
  flutter_widget_from_html_core: ^0.10.4
  # google_mlkit_face_detection: ^0.13.1
  # tflite_flutter: ^0.10.4
  extended_masked_text: ^2.3.1
  cached_network_image: ^3.1.0
  flutter_localizations:
    sdk: flutter
  flutter_image_compress: ^2.3.0
  path_provider:
  path:
  image:
  collection: ^1.17.2
  latlong2: ^0.9.0
  proj4dart: ^2.1.0
  toggle_switch: ^2.1.0
  fluttertoast: ^8.2.5
  datepicker_dropdown: ^0.1.5
  dotted_border: ^2.1.0
  signature: ^5.3.0
  lottie: ^2.7.0
  pretty_dio_logger: ^1.4.0
  device_info_plus: ^9.1.2
  flutter_local_notifications: ^19.5.0
  flutter_timezone: ^5.0.1
  dio: ^5.9.0
  camera: ^0.11.3
  google_maps_flutter: ^2.14.0
  url_launcher: ^6.3.2
  firebase_core: ^4.3.0
  firebase_messaging: ^16.1.0
  internet_connection_checker_plus: ^2.9.1+2
  flutter_launcher_icons: ^0.14.4


dev_dependencies:
  flutter_test:
    sdk: flutter

  flutter_lints: ^5.0.0

flutter_icons:
  image_path_ios: "images/launcher_icon_desnet.png"
  image_path_android: "images/launcher_icon.png"
  ios: true
  android: true

flutter:
  uses-material-design: true

  assets:
    - assets/
    - assets/id/
    - assets/id/absensi/
    - assets/id/template/
    - assets/en/
    - assets/en/absensi/
    - assets/en/template/
    - images/
    - images/bahasa/
    - images/absensi/
    - images/asset_dashboard/
    - images/lupa_password/
    - images/icon_bottom_nav/
    - images/login/
    - images/menu_dashboard/
    - images/rekap/
    - images/shift/
    - images/pkwt/
    - images/reimbursement/
    - images/akun/
    - images/camera/
    - images/kontak/
    - images/sales_activity/
    - images/kpi/
    - .env
  
```

### Catatan Penting

- ‚úÖ \*\*Sesuaikan versi di \*\*`pubspec.yaml` jika project custom menggunakan versi SDK berbeda
- ‚ùå `google_mlkit` dan `tflite` **dihapus** pada base project
- ‚ö†Ô∏è **Untuk case custom**, `google_mlkit` **tetap di-install sesuai kebutuhan**
- ‚ö†Ô∏è jika custom menggunakan scanner qr hapus qr scanner yang ada di pubspec.yml di ganti menggunakan native android dan ios karena dependencies tersebut belum support 16kb page size
- üìÅ Pindahkan folder `lib/` dari project lama ke project baru
- üîß Rapikan dan sesuaikan **import package** agar kompatibel dengan Flutter 3.35.6
- jalankan

  ```
  flutter pub get
  ```

## **Penyesuaian build.gradle.kts**

contoh build.gradle.kts

```
import java.util.Properties
import java.io.FileInputStream
plugins {
    id("com.android.application")
    id("kotlin-android")
    id("dev.flutter.flutter-gradle-plugin")
    id("com.google.gms.google-services")
}

val keystoreProperties = Properties()
val keystorePropertiesFile = rootProject.file("key.properties")

if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(FileInputStream(keystorePropertiesFile))
}

android {
    namespace = "com.absenku.professional"
    compileSdk = 36

    ndkVersion = "27.0.12077973"

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
        isCoreLibraryDesugaringEnabled = true
    }

    kotlinOptions {
        jvmTarget = "11"
    }

    defaultConfig {
        applicationId = "com.absenku.professional"
        minSdk = 26
        targetSdk = 36
        versionCode = flutter.versionCode
        versionName = flutter.versionName
        externalNativeBuild {
        cmake {
            cppFlags += listOf("-O3", "-fvisibility=hidden")
            arguments += "-DCMAKE_SHARED_LINKER_FLAGS=-Wl,-z,max-page-size=16384"
            }
        }
    }
    externalNativeBuild {
        cmake {
            path(file("CMakeLists.txt"))
            version = "3.22.1+"
        }
    }

    signingConfigs {
        create("release") {
            keyAlias = keystoreProperties["keyAlias"] as String
            keyPassword = keystoreProperties["keyPassword"] as String
            storeFile = file(keystoreProperties["storeFile"] as String)
            storePassword = keystoreProperties["storePassword"] as String
        }
    }

    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }

        debug {
            signingConfig = signingConfigs.getByName("debug")
        }
    }

    externalNativeBuild {
        cmake {
            version = "3.22.1+"
        }
    }
}

dependencies {
    coreLibraryDesugaring("com.android.tools:desugar_jdk_libs:2.1.5")

    implementation("androidx.appcompat:appcompat:1.7.0")
    implementation("com.google.android.material:material:1.12.0")

    // CameraX
    implementation("androidx.camera:camera-camera2:1.4.2")
    implementation("androidx.camera:camera-lifecycle:1.4.2")
    implementation("androidx.camera:camera-view:1.4.2")

    // ML Kit Face Detection (tidak tarik barhopper)
    implementation("com.google.mlkit:face-detection:16.1.7")


    // LiteRT
    implementation("com.google.ai.edge.litert:litert:1.4.0")
    implementation("com.google.ai.edge.litert:litert-api:1.4.0")
    implementation("com.google.ai.edge.litert:litert-support:1.4.0")
    implementation("com.google.ai.edge.litert:litert-metadata:1.4.0")

    // Firebase BOM (versi terbaru 2025)
    implementation(platform("com.google.firebase:firebase-bom:33.5.1"))
    implementation("com.google.firebase:firebase-analytics-ktx:21.3.0")
    implementation("com.google.firebase:firebase-auth-ktx:22.1.1")
    implementation("com.google.firebase:firebase-firestore-ktx:24.6.0")

    // Location
    implementation("com.google.android.gms:play-services-location:21.3.0")

    // Coroutines
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.8.1")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.8.7")

    // Zxing Camera Qr
    implementation ("com.google.zxing:core:3.5.2")
}

flutter {
    source = "../.."
}
```

<Warning>
  copy terlebih dahulu file **key.poperties** dari project lama ke project baru. karena file tersebut belum ada di project baru
</Warning>

project custom masih menggunakan gradle.kt dan project flutter terbaru sudah menggunakan gradle DSL bisa di sesuaikan seperti di atas

jika sebelumnya menggunakan tensorflow lite silahkan di ganti ke:

```
  implementation("com.google.ai.edge.litert:litert:1.4.0")
  implementation("com.google.ai.edge.litert:litert-api:1.4.0")
  implementation("com.google.ai.edge.litert:litert-support:1.4.0")
  implementation("com.google.ai.edge.litert:litert-metadata:1.4.0")
```

<Info>
  karena tensorflow lite belum support 16kb page size jadi migrasi ke **com.google.ai.edge.litert**
</Info>

### Copy code kotlin ke poject baru

seperti camera, security,layout dan google.service.json dll.

## Sesuaikan File **AndroidManifesf.xml**

contoh code **AndroidManifest.xml**

```
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/>
    <!-- <uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" /> -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>
    <application
        android:label="Absenku Professional"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>
        <activity
            android:name="com.example.absenkuv3.facex.FaceCameraXActivity"
            android:exported="false"
            android:theme="@style/Theme.AppCompat.NoActionBar"
            android:configChanges="orientation"
            android:screenOrientation="portrait"/>
        <activity
            android:name="com.example.absenkuv3.camerax.CameraxActivity"
            android:exported="false"
            android:theme="@style/Theme.AppCompat.NoActionBar"
            android:configChanges="orientation"
            android:screenOrientation="fullSensor"/>
        <activity 
            android:name="com.example.absenkuv3.camerascanner.CameraScannerActivity" 
            android:exported="false" 
            android:theme="@style/Theme.AppCompat.Light.NoActionBar"/>
        <receiver android:exported="false" android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationReceiver" />
        <receiver android:exported="false" android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED"/>
                <action android:name="android.intent.action.MY_PACKAGE_REPLACED"/>
                <action android:name="android.intent.action.QUICKBOOT_POWERON" />
                <action android:name="com.htc.intent.action.QUICKBOOT_POWERON"/>
            </intent-filter>
        </receiver>
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
                <meta-data
            android:name="com.google.firebase.ml.vision.DEPENDENCIES"
            android:value="ocr" />
        <meta-data
            android:name="com.google.android.geo.API_KEY"
            android:value="AIzaSyAZFJyvOqyUg5U_ijg7o13qYl412L5t83c" />

        <uses-native-library
            android:name="libOpenCL.so"
            android:required="false" />
        <uses-native-library
            android:name="libOpenCL-car.so"
            android:required="false" />
        <uses-native-library
            android:name="libOpenCL-pixel.so"
            android:required="false" />
    </application>
    <!-- Required to query activities that can process text, see:
         https://developer.android.com/training/package-visibility and
         https://developer.android.com/reference/android/content/Intent#ACTION_PROCESS_TEXT.

         In particular, this is used by the Flutter engine in io.flutter.plugin.text.ProcessTextPlugin. -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT"/>
            <data android:mimeType="text/plain"/>
        </intent>
    </queries>
</manifest>
```

## Sesuakian File MainActivity.kt

contoh code **MainActivity.xml**

```
package com.absenku.professional

import android.content.Intent
import androidx.annotation.NonNull
import com.example.absenkuv3.broadcast.EventChannelHandler
import com.example.absenkuv3.camerax.CameraxActivity
import com.example.absenkuv3.facex.FaceCameraXActivity
import com.example.absenkuv3.camerascanner.CameraScannerActivity
import io.flutter.embedding.android.FlutterActivity
import io.flutter.embedding.engine.FlutterEngine
import io.flutter.plugin.common.MethodChannel
import android.app.NotificationChannel
import android.app.NotificationManager
import android.content.Context
import android.os.Build
import android.os.Bundle
import android.media.AudioAttributes
import android.net.Uri
import android.content.ContentResolver
import android.util.Log
import android.media.MediaPlayer
import com.example.absenkuv3.security.SecurityChecker
import android.location.LocationManager
import android.location.Location
import android.provider.Settings
import android.os.Build.VERSION_CODES

class MainActivity: FlutterActivity() {
    private val tag = "MainActivity"
    private val SCANNER_CHANNEL = "absenku/camerascanner"
    private var pendingResult: MethodChannel.Result? = null
    private lateinit var securityChecker: SecurityChecker
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        createNotificationChannel(this)
    }
    override fun configureFlutterEngine(@NonNull flutterEngine: FlutterEngine) {
        super.configureFlutterEngine(flutterEngine)
        securityChecker = SecurityChecker(this)
        val eventChannelHandler = EventChannelHandler(context = applicationContext)
        eventChannelHandler.startListening(flutterEngine, CHARGING_CHANNEL, tag)

        MethodChannel(flutterEngine.dartExecutor.binaryMessenger, SCANNER_CHANNEL)
            .setMethodCallHandler { call, result ->
                if (call.method == "startCameraScanner") {
                    pendingResult = result
                    val intent = Intent(this, CameraScannerActivity::class.java)
                    startActivityForResult(intent, 999)
                } else {
                    result.notImplemented()
                }
            }
        MethodChannel(flutterEngine.dartExecutor, "com.example.absenkuv3/security")
            .setMethodCallHandler { call, result ->
                when (call.method) {
                    "isDeveloperModeEnabled" -> {
                        val isDevMode = securityChecker.isDeveloperModeEnabled(context)
                        result.success(isDevMode)
                    }
                    else -> result.notImplemented()
                }
            }

        MethodChannel(flutterEngine.dartExecutor, "com.example.absenkuv3")
        .setMethodCallHandler { call, result ->
            when (call.method) {
                "startCekSource" -> {
                    val installer =
                        context.packageManager.getInstallerPackageName(context.packageName)
                    val installer2 = installer ?: "unknown"
                    result.success(installer2)
                }
                else -> result.notImplemented()
            }
        }

        MethodChannel(flutterEngine.dartExecutor, "com.example.absenkuv3/location")
        .setMethodCallHandler { call, result ->
            when (call.method) {
                "isLocationFake" -> {
                    val isFake = isLocationFromMockProvider(this)
                    result.success(isFake)
                }
                else -> result.notImplemented()
            }
        }

        MethodChannel(flutterEngine.dartExecutor, "com.example.absenkuv3/security")
        .setMethodCallHandler { call, result ->
            when (call.method) {
                "isDeveloperModeEnabled" -> {
                    val isDevMode = securityChecker.isDeveloperModeEnabled(context)
                    result.success(isDevMode)
                }
                else -> result.notImplemented()
            }
        }
        MethodChannel(
            flutterEngine.dartExecutor,
            CAMERAX_CHANELL
        ).setMethodCallHandler { call, result ->
            if ((call.method == "startCameraXActivity")) {
                val kameraBelakang = call.argument<Boolean>("kameraBelakang")
                val headerText = call.argument<String>("header_text")
                Log.d(tag, "Nilai kameraBelakang1: $kameraBelakang")
                Log.d(tag, "Header text received main: $headerText")
                val intent = Intent(this, CameraxActivity::class.java)
                intent.putExtra(CameraxActivity.EXTRA_KAMERA_BELAKANG, kameraBelakang)
                intent.putExtra(CameraxActivity.EXTRA_HEADER_TEXT, headerText)
                startActivity(intent)
            }
            if ((call.method == "startFaceCameraXActivity")) {
                val matrix = call.argument<String>("matrix")
                val register = call.argument<Boolean>("register")
                val peringatan = call.argument<String>("peringatan")
                val language = call.argument<String>("language")
                Log.d(tag, "Nilai Language: $language")
                val cosineThreshold = call.argument<Double>("cosineThreshold")!!.toDouble()
                val l2Threshold = call.argument<Double>("l2Threshold")!!.toDouble()
                val cosine: Double = 0.4
                val l2: Double = 7.5
                val headerText = call.argument<String>("header_text")
                val intent = Intent(this@MainActivity, FaceCameraXActivity::class.java)
                intent.putExtra(FaceCameraXActivity.EXTRA_MATRIX, matrix)
                intent.putExtra(FaceCameraXActivity.EXTRA_REGISTER, register)
                intent.putExtra(FaceCameraXActivity.EXTRA_PERINGATAN, peringatan)
                intent.putExtra(FaceCameraXActivity.EXTRA_COSINETHRESHOLD, cosineThreshold)
                intent.putExtra(FaceCameraXActivity.EXTRA_L2THRESHOLD, l2Threshold)
                intent.putExtra(FaceCameraXActivity.EXTRA_LANGUAGE, language)
                intent.putExtra(FaceCameraXActivity.EXTRA_HEADER_TEXT, headerText)
                startActivity(intent)
            }
            else {
                result.notImplemented()
            }
        }
    }
    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)

        if (requestCode == 999) {
            if (resultCode == RESULT_OK) {
                val qrCode = data?.getStringExtra(CameraScannerActivity.RESULT_QR_CODE)
                pendingResult?.success(qrCode)
            } else {
                pendingResult?.success(null)
            }
            pendingResult = null
        }
    }
    companion object {
        private const val CAMERAX_CHANELL = "absenku/camerax"
        private const val CHARGING_CHANNEL = "absenku/camerax/report"

    }
    data class NotificationChannelData(val id: String, val name: String, val soundResId: Int)
    private fun createNotificationChannel(context: Context) {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
        val channels = listOf(
            NotificationChannelData("channel_id_1", "absensi", R.raw.absenku),
            NotificationChannelData("channel_id_2", "general", R.raw.access),
            NotificationChannelData("channel_id_3", "emergency", R.raw.emergency)
        )

        val notificationManager = context.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager

            channels.forEach { channelData ->
                val soundUri = Uri.parse("android.resource://${context.packageName}/${channelData.soundResId}")
                val audioAttributes = AudioAttributes.Builder()
                    .setUsage(AudioAttributes.USAGE_ALARM)
                    .setContentType(AudioAttributes.CONTENT_TYPE_SONIFICATION)
                    .build()
                val vibrationPattern = LongArray(60) { index ->
                    if (index % 2 == 0) 500L else 500L
                    }
                val channel = NotificationChannel(channelData.id, channelData.name, NotificationManager.IMPORTANCE_HIGH).apply {
                    description = channelData.name
                    setSound(soundUri, audioAttributes)
                    enableVibration(true)
                    setBypassDnd(true)
                    this.vibrationPattern = vibrationPattern
                }
                notificationManager.createNotificationChannel(channel)
            }
        }
        }
        private fun isLocationFromMockProvider(context: Context): Boolean {
        val locationManager = context.getSystemService(Context.LOCATION_SERVICE) as LocationManager

        return if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.JELLY_BEAN_MR2) {
            try {
                // Check if any provider has mock location enabled
                val providers = locationManager.allProviders
                for (provider in providers) {
                    val location: Location? = locationManager.getLastKnownLocation(provider)
                    location?.let {
                        if (it.isFromMockProvider) {
                            return true
                        }
                    }
                }
                false
            } catch (e: Exception) {
                false
            }
        } else {
            // For older versions
            android.provider.Settings.Secure.getInt(
                context.contentResolver,
                android.provider.Settings.Secure.ALLOW_MOCK_LOCATION, 0
            ) != 0
        }
     }
}
```

<Warning>
  Sesuaikan dengan yang ada di project lama channel channel yang digunakan
</Warning>

## Case khusus project custom yang sudah menggunakan **CmakeList.txt**

<Warning>
  pindahkan file tersebut ke root project android di **app** yang letaknya sejajar dengan file **google-service.json**
</Warning>

lalu sesuakain kode nya seperti di bawah agar support 16 kb page size

```
cmake_minimum_required(VERSION 3.22.1)

# Library utama
add_library(security_checks SHARED
    src/main/cpp/security_checks.cpp
)

find_library(log-lib log)
target_link_libraries(security_checks ${log-lib})

# === OPTIMASI & 16KB PAGE SIZE UNTUK NDK 27 (LLD Linker) ===
# Compile options: optimasi + hidden visibility
target_compile_options(security_checks PRIVATE
    -O3
    -fvisibility=hidden
    -ffunction-sections
    -fdata-sections
)

# Link options: GC sections + strip + NO undefined + 16KB SUPPORT
target_link_options(security_checks PRIVATE
    -Wl,--gc-sections      # Buang kode mati
    -Wl,--strip-all        # Strip symbols (release/debug)
    -Wl,--no-undefined     # Error kalau ada undefined symbols
    -Wl,-z,max-page-size=16384
)
```

## Cek 16 Kb Page Size

Buka android studio lalu cari build lalu pilih Analyze Apk pilih APK bisa debug maupun realease

![16kb](/16kb.png)

<Note>
  Pastikan semua nya sudah Alignment nya 16 KB
</Note>